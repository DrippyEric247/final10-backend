{"ast":null,"code":"import React,{useRef,useEffect,useCallback}from\"react\";import{useInfiniteQuery}from\"@tanstack/react-query\";import{Link}from\"react-router-dom\";import ebayService from\"../services/ebayService\";import{useAuth}from\"../context/AuthContext\";import\"../styles/ProductFeed.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";async function fetchFeed(_ref){var _data$pagination;let{pageParam}=_ref;const page=pageParam||1;const data=await ebayService.searchItems({page,limit:20,sortOrder:'EndTimeSoonest'});// expected shape: { items: [...], nextCursor: \"...\" | null }\nreturn{items:data.items||[],nextCursor:(_data$pagination=data.pagination)!==null&&_data$pagination!==void 0&&_data$pagination.hasNextPage?page+1:null};}export default function ProductFeed(){const{user}=useAuth();const{data,fetchNextPage,hasNextPage,isFetchingNextPage,status,error}=useInfiniteQuery({queryKey:[\"productFeed\"],queryFn:fetchFeed,getNextPageParam:last=>{var _last$nextCursor;return(_last$nextCursor=last===null||last===void 0?void 0:last.nextCursor)!==null&&_last$nextCursor!==void 0?_last$nextCursor:undefined;},enabled:!!user// Only run query if user is logged in\n});const sentinelRef=useRef(null);const onIntersect=useCallback(entries=>{const first=entries[0];if(first.isIntersecting&&hasNextPage&&!isFetchingNextPage){fetchNextPage();}},[fetchNextPage,hasNextPage,isFetchingNextPage]);useEffect(()=>{const observer=new IntersectionObserver(onIntersect,{rootMargin:\"300px\"});if(sentinelRef.current)observer.observe(sentinelRef.current);return()=>observer.disconnect();},[onIntersect]);if(!user){return/*#__PURE__*/_jsxs(\"div\",{className:\"feed-wrap\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"feed-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Product Feed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"muted\",children:\"Swipe/scroll through hot auctions across platforms.\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"feed-status\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Please \",/*#__PURE__*/_jsx(Link,{to:\"/login\",children:\"login\"}),\" to view the product feed\"]})})]});}if(status===\"loading\")return/*#__PURE__*/_jsx(\"div\",{className:\"feed-status\",children:\"Loading\\u2026\"});if(status===\"error\")return/*#__PURE__*/_jsxs(\"div\",{className:\"feed-status\",children:[\"Error: \",String(error)]});const items=(data===null||data===void 0?void 0:data.pages.flatMap(p=>p.items))||[];return/*#__PURE__*/_jsxs(\"div\",{className:\"feed-wrap\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"feed-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Product Feed\"}),/*#__PURE__*/_jsx(\"p\",{className:\"muted\",children:\"Swipe/scroll through hot auctions across platforms.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"feed-grid\",children:[items.map(it=>{var _it$currentPrice$toLo,_it$currentPrice,_it$currentPrice$toLo2,_it$bids,_it$competition;return/*#__PURE__*/_jsxs(\"article\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"thumb\",children:[/*#__PURE__*/_jsx(\"img\",{src:it.image||\"/placeholder.png\",alt:it.title,loading:\"lazy\"}),/*#__PURE__*/_jsx(\"span\",{className:\"chip\",children:\"eBay\"}),typeof it.aiScore===\"number\"&&/*#__PURE__*/_jsxs(\"span\",{className:\"chip chip-score\",children:[\"AI \",Math.round(it.aiScore),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"meta\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"title\",title:it.title,children:it.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"price\",children:[\"$\",(_it$currentPrice$toLo=(_it$currentPrice=it.currentPrice)===null||_it$currentPrice===void 0?void 0:(_it$currentPrice$toLo2=_it$currentPrice.toLocaleString)===null||_it$currentPrice$toLo2===void 0?void 0:_it$currentPrice$toLo2.call(_it$currentPrice))!==null&&_it$currentPrice$toLo!==void 0?_it$currentPrice$toLo:it.price]}),/*#__PURE__*/_jsxs(\"span\",{className:\"end\",children:[\"Ends \",it.endsIn||it.endsAtHuman]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"sub\",children:[\"Bids: \",(_it$bids=it.bids)!==null&&_it$bids!==void 0?_it$bids:0]}),/*#__PURE__*/_jsxs(\"span\",{className:\"sub\",children:[\"Competition: \",(_it$competition=it.competition)!==null&&_it$competition!==void 0?_it$competition:\"â€”\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"actions\",children:[it.auctionId?/*#__PURE__*/_jsx(Link,{className:\"btn btn-primary\",to:\"/auctions/\".concat(it.auctionId),children:\"Open Auction\"}):it.url?/*#__PURE__*/_jsx(\"a\",{className:\"btn btn-primary\",href:it.url,target:\"_blank\",rel:\"noreferrer\",children:\"Open\"}):null,/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-ghost\",onClick:()=>{var _navigator$share,_navigator;return(_navigator$share=(_navigator=navigator).share)===null||_navigator$share===void 0?void 0:_navigator$share.call(_navigator,{title:it.title,url:it.url||window.location.href}).catch(()=>{});},children:\"Share\"})]})]},it.id);}),/*#__PURE__*/_jsx(\"div\",{ref:sentinelRef})]}),isFetchingNextPage&&/*#__PURE__*/_jsx(\"div\",{className:\"feed-status\",children:\"Loading more\\u2026\"}),!hasNextPage&&/*#__PURE__*/_jsx(\"div\",{className:\"feed-status muted\",children:\"You\\u2019re all caught up.\"})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}