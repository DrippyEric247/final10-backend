{"ast":null,"code":"// src/pages/PointsPage.js\nimport React,{useEffect,useMemo,useState}from'react';import{useAppConfig}from'../lib/useAppConfig';// tiny helpers\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const fmt=n=>(n!==null&&n!==void 0?n:0).toLocaleString();const pct=n=>\"\".concat(Math.round((n!==null&&n!==void 0?n:0)*100),\"%\");export default function PointsPage(){const cfg=useAppConfig();// trialDays, multipliers, badgeTiers, discountRatio, etc.\nconst[loading,setLoading]=useState(true);// user data\nconst[balance,setBalance]=useState(0);const[lifetime,setLifetime]=useState(0);const[badges,setBadges]=useState([]);const[history,setHistory]=useState([]);const[trial,setTrial]=useState(null);// leaderboard preview\nconst[leaders,setLeaders]=useState([]);// redeem UI\nconst[redeemAmt,setRedeemAmt]=useState('');const[toast,setToast]=useState('');// countdown text\nconst[countdown,setCountdown]=useState('');useEffect(()=>{let mounted=true;(async()=>{try{const token=localStorage.getItem('f10_token');const response=await fetch('http://localhost:5000/api/points/me',{headers:{'Authorization':\"Bearer \".concat(token),'Content-Type':'application/json'}});if(!response.ok){if(response.status===429){console.warn('Rate limited, will retry later');return;}throw new Error(\"HTTP \".concat(response.status,\": \").concat(response.statusText));}const me=await response.json();if(!mounted)return;setBalance(me.pointsBalance||0);setLifetime(me.lifetimePointsEarned||0);setBadges(me.badges||[]);setHistory(me.recent||[]);setTrial(me.trial||null);}catch(error){console.error('Failed to fetch points data:',error);if(!mounted)return;// Set default values on error\nsetBalance(0);setLifetime(0);setBadges([]);setHistory([]);setTrial(null);}finally{if(mounted)setLoading(false);}})();// leaderboard preview (top 5) - with error handling\nfetch('http://localhost:5000/api/leaderboard/lifetime').then(async r=>{if(!r.ok){if(r.status===429){console.warn('Rate limited on leaderboard, will retry later');return[];}throw new Error(\"HTTP \".concat(r.status,\": \").concat(r.statusText));}return r.json();}).then(list=>setLeaders(Array.isArray(list)?list.slice(0,5):[])).catch(error=>{console.error('Failed to fetch leaderboard:',error);setLeaders([]);});return()=>{mounted=false;};},[]);// trial countdown (minutes precision)\nuseEffect(()=>{if(!(trial!==null&&trial!==void 0&&trial.isActive)||!(trial!==null&&trial!==void 0&&trial.endsAt))return;const tick=()=>{const ms=new Date(trial.endsAt)-new Date();if(ms<=0){setCountdown('Expired');return;}const d=Math.floor(ms/86400000);const h=Math.floor(ms%86400000/3600000);const m=Math.floor(ms%3600000/60000);setCountdown(\"\".concat(d,\"d \").concat(h,\"h \").concat(m,\"m\"));};tick();const id=setInterval(tick,60000);return()=>clearInterval(id);},[trial]);// derived: example discount preview\nconst discountPreview=useMemo(()=>{const pts=parseInt(redeemAmt||'0',10);if(!Number.isFinite(pts)||!(cfg!==null&&cfg!==void 0&&cfg.discountRatio))return'$0.00';const usd=pts*cfg.discountRatio;return\"$\".concat(usd.toFixed(2));},[redeemAmt,cfg]);const redeem=async()=>{const amount=parseInt(redeemAmt||'0',10);if(!amount||amount<=0)return setToast('Enter a positive number of points.');if(amount>balance)return setToast('Not enough points to redeem.');const body={amount,auctionId:window.__AUCTION_ID__||'demo-auction',idempotencyKey:crypto.randomUUID()};try{const token=localStorage.getItem('f10_token');const response=await fetch('http://localhost:5000/api/points/redeem',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(body)});if(!response.ok){if(response.status===429){setToast('Too many requests. Please wait a moment and try again.');setTimeout(()=>setToast(''),2500);return;}throw new Error(\"HTTP \".concat(response.status,\": \").concat(response.statusText));}const resp=await response.json();if(resp!==null&&resp!==void 0&&resp.ok){setToast(\"Redeemed \".concat(fmt(amount),\" points \\u2192 \").concat(resp.discountUSD?\"$\".concat(resp.discountUSD.toFixed(2),\" off\"):'applied'));// refresh me\nconst meResponse=await fetch('http://localhost:5000/api/points/me',{headers:{'Authorization':\"Bearer \".concat(token),'Content-Type':'application/json'}});if(meResponse.ok){const me=await meResponse.json();setBalance(me.pointsBalance||0);setLifetime(me.lifetimePointsEarned||0);setBadges(me.badges||[]);setHistory(me.recent||[]);}setRedeemAmt('');}else{setToast((resp===null||resp===void 0?void 0:resp.error)||'Redeem failed');}}catch(error){console.error('Redeem error:',error);setToast('Network error. Please try again.');}setTimeout(()=>setToast(''),2500);};if(!cfg)return/*#__PURE__*/_jsx(\"div\",{style:{padding:24},children:\"Loading config\\u2026\"});if(loading)return/*#__PURE__*/_jsx(\"div\",{style:{padding:24},children:\"Loading points\\u2026\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",style:{maxWidth:960,margin:'32px auto',padding:'0 16px'},children:[toast&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#111',color:'#fff',padding:'10px 14px',borderRadius:8,marginBottom:16,border:'1px solid #333'},children:toast}),/*#__PURE__*/_jsxs(\"section\",{style:{marginBottom:24,padding:16,borderRadius:12,background:'rgba(255,255,255,0.04)',border:'1px solid #2a2a2a'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:'0 0 6px'},children:\"Final10 is Live\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:0,opacity:0.9},children:\"AI-powered auctions, SavvyPoints, and product-first social.\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12,display:'flex',gap:10},children:[/*#__PURE__*/_jsx(\"a\",{className:\"btn\",href:\"/auctions\",children:\"Browse Auctions\"}),/*#__PURE__*/_jsx(\"a\",{className:\"btn btn-outline\",href:\"/points\",children:\"View Points\"})]})]}),trial!==null&&trial!==void 0&&trial.isActive?/*#__PURE__*/_jsxs(\"section\",{style:{marginBottom:16,padding:12,borderRadius:10,background:'#0b2a12',color:'#c6ffd1',border:'1px solid #1f6f33'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Free Trial Active\"}),\" \\u2014 \",cfg.trialDays,\" days \\xB7 Bonus \",pct(cfg.trialBonusMultiplier),countdown&&countdown!=='Expired'?/*#__PURE__*/_jsxs(\"span\",{style:{marginLeft:8,opacity:0.9},children:[\"\\u2022 Ends in \",countdown]}):null,/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location='/premium',style:{marginLeft:12,padding:'6px 10px',borderRadius:8,border:'1px solid #2da160',background:'#1a7f43',color:'#fff'},children:\"Keep the Boost\"})]}):/*#__PURE__*/_jsxs(\"section\",{style:{marginBottom:16,padding:12,borderRadius:10,background:'#2a1a1a',color:'#ffd5d5',border:'1px solid #6f2a2a'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Trial Ended\"}),\" \\u2014 Upgrade to keep accelerated earnings.\",/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.location='/premium',style:{marginLeft:12,padding:'6px 10px',borderRadius:8,border:'1px solid #b54',background:'#a33',color:'#fff'},children:[\"Get Premium (+\",pct(cfg.premiumBonusMultiplier),\")\"]})]}),/*#__PURE__*/_jsxs(\"section\",{style:{marginBottom:24,padding:20,borderRadius:12,background:'rgba(255,255,255,0.02)',border:'1px solid #2a2a2a'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0,marginBottom:16},children:\"Free vs Premium\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:20},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:16,borderRadius:8,background:'rgba(59, 130, 246, 0.1)',border:'1px solid rgba(59, 130, 246, 0.3)'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 12px',color:'#60a5fa'},children:\"Free Tier\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{margin:0,padding:0,listStyle:'none'},children:[/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 5 searches per day\"}),/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Basic auction browsing\"}),/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Daily tasks & points\"}),/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Community features\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12,fontSize:18,fontWeight:'bold',color:'#60a5fa'},children:\"$0/month\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:16,borderRadius:8,background:'rgba(168, 85, 247, 0.1)',border:'1px solid rgba(168, 85, 247, 0.3)'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 12px',color:'#a855f7'},children:\"Premium\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{margin:0,padding:0,listStyle:'none'},children:[/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Unlimited searches\"}),/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Premium auction access\"}),/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Advanced filters & AI\"}),/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:8,fontSize:14,color:'#d1d5db'},children:\"\\u2713 Priority support\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12,fontSize:18,fontWeight:'bold',color:'#a855f7'},children:\"$7/month\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16,padding:12,borderRadius:8,background:'rgba(34, 197, 94, 0.1)',border:'1px solid rgba(34, 197, 94, 0.3)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8,marginBottom:8},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:16},children:\"\\uD83D\\uDE80\"}),/*#__PURE__*/_jsx(\"strong\",{style:{color:'#22c55e'},children:\"Coming Soon: Multi-App Subscription\"})]}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'0 0 8px',fontSize:14,color:'#d1d5db'},children:\"One plan, multiple industries: E-commerce, Real Estate, Automotive, and more. Shared points system across all platforms!\"}),/*#__PURE__*/_jsx(\"a\",{href:\"/pricing\",style:{color:'#22c55e',textDecoration:'none',fontSize:14,fontWeight:'500'},children:\"View detailed pricing \\u2192\"})]})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"card\",style:{marginBottom:24,padding:16,borderRadius:12,border:'1px solid #2a2a2a'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"Points\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:24,flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{opacity:0.8},children:\"Balance\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:24,fontWeight:700},children:[fmt(balance),\" SavvyPoints\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{opacity:0.8},children:\"Lifetime Earned\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:20,fontWeight:600},children:fmt(lifetime)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{opacity:0.8},children:\"Badges\"}),/*#__PURE__*/_jsx(\"div\",{children:badges!==null&&badges!==void 0&&badges.length?badges.map(b=>/*#__PURE__*/_jsx(\"span\",{style:{padding:'2px 8px',border:'1px solid #333',borderRadius:999,marginRight:6},children:b.name},b.name)):/*#__PURE__*/_jsx(\"span\",{style:{opacity:0.7},children:\"None yet\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16,display:'flex',gap:10,alignItems:'center',flexWrap:'wrap'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:redeemAmt,onChange:e=>setRedeemAmt(e.target.value),placeholder:\"Enter points to redeem\",style:{padding:'8px 10px',borderRadius:8,border:'1px solid #444',minWidth:220}}),/*#__PURE__*/_jsxs(\"button\",{onClick:redeem,className:\"btn\",disabled:!redeemAmt,children:[\"Redeem \\u2192 (\",discountPreview,\" off)\"]}),/*#__PURE__*/_jsx(\"div\",{style:{opacity:0.8},children:\"Redeemable on any Final10 auction.\"})]})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"card\",style:{marginBottom:24,padding:16,borderRadius:12,border:'1px solid #2a2a2a'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"Recent Activity\"}),history!==null&&history!==void 0&&history.length?/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0,margin:0},children:history.map((item,index)=>/*#__PURE__*/_jsxs(\"li\",{style:{display:'flex',gap:12,padding:'8px 0',borderBottom:'1px solid #222'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:12,padding:'2px 8px',borderRadius:999,border:'1px solid #333',textTransform:'capitalize'},children:item.type.replace('_',' ')}),/*#__PURE__*/_jsxs(\"span\",{style:{fontWeight:600},children:[item.type==='redeem'||item.type==='transfer_out'?'-':'+',fmt(item.amount)]}),/*#__PURE__*/_jsx(\"span\",{style:{opacity:0.7},children:new Date(item.createdAt).toLocaleString()}),item.source?/*#__PURE__*/_jsxs(\"span\",{style:{opacity:0.7},children:[\"\\u2022 \",item.source]}):null]},\"history-\".concat(item._id||index,\"-\").concat(index)))}):/*#__PURE__*/_jsx(\"div\",{style:{opacity:0.7},children:\"No activity yet.\"})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"card\",style:{marginBottom:32,padding:16,borderRadius:12,border:'1px solid #2a2a2a'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"Top Earners \\u2014 Lifetime (Top 5)\"}),leaders!==null&&leaders!==void 0&&leaders.length?/*#__PURE__*/_jsx(\"ol\",{style:{margin:0,paddingLeft:20},children:leaders.map((u,i)=>/*#__PURE__*/_jsxs(\"li\",{style:{padding:'6px 0',display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"@\",u.username]}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600},children:fmt(u.lifetimePointsEarned)})]},\"leader-\".concat(u._id||u.username||i,\"-\").concat(i)))}):/*#__PURE__*/_jsx(\"div\",{style:{opacity:0.7},children:\"Leaderboard warming up\\u2026\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:10},children:/*#__PURE__*/_jsx(\"a\",{className:\"btn btn-outline\",href:\"/leaderboard\",children:\"View Full Leaderboard\"})})]}),/*#__PURE__*/_jsxs(\"footer\",{style:{opacity:0.7,textAlign:'center',padding:'24px 0'},children:[\"\\xA9 \",new Date().getFullYear(),\" Final10 \\xB7 Stay Earning. Stay Savvy.\"]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}